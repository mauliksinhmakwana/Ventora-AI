<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nebula AI</title>
    <style>
        :root {
            --bg: #000000;
            --surface: #0a0a0a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border: rgba(255, 255, 255, 0.1);
            --accent-blue: #007aff;
            --glass: rgba(255, 255, 255, 0.03);
            --code-bg: #1a1a1a;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, "SF Pro Display", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg); color: var(--text-primary);
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- BACKGROUND --- */
        .stars-container {
            position: fixed; top: 0; left: 0; width: 200%; height: 200%; z-index: -1;
            background-image: radial-gradient(1px 1px at 20px 30px, #fff, rgba(0,0,0,0)),
                              radial-gradient(1.2px 1.2px at 40px 70px, #fff, rgba(0,0,0,0)),
                              radial-gradient(1.5px 1.5px at 150px 150px, #fff, rgba(0,0,0,0));
            background-repeat: repeat; background-size: 300px 300px;
            animation: drift 120s linear infinite; opacity: 0.4;
        }
        @keyframes drift { from { transform: translate(0, 0); } to { transform: translate(-300px, -300px); } }
        .nebula-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% 50%, rgba(50, 50, 150, 0.1), transparent 70%); }

        /* --- REFINED HEADER --- */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000; height: 60px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }
        .version-badge {
            font-size: 0.6rem; background: rgba(255,255,255,0.1); padding: 2px 8px;
            border-radius: 4px; color: var(--text-secondary); letter-spacing: 1px;
            border: 1px solid var(--border);
        }

        /* --- MAIN CHAT --- */
        main {
            flex: 1; margin-top: 60px; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column; gap: 24px; width: 100%;
            max-width: 800px; align-self: center; scrollbar-width: none;
        }
        main::-webkit-scrollbar { display: none; }

        .msg-wrapper { display: flex; flex-direction: column; width: 100%; animation: fadeIn 0.3s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .msg { max-width: 90%; line-height: 1.6; font-size: 0.95rem; white-space: pre-wrap; }
        .user { align-self: flex-end; border-right: 2px solid white; padding-right: 15px; text-align: right; }
        .ai { align-self: flex-start; border-left: 1px solid var(--border); padding-left: 15px; color: var(--text-secondary); }

        /* --- ADVANCED CODE BLOCK --- */
        .code-container {
            background: var(--code-bg); border-radius: 8px; margin: 10px 0;
            border: 1px solid var(--border); overflow: hidden;
        }
        .code-header {
            background: rgba(255,255,255,0.05); padding: 8px 15px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; color: var(--text-secondary);
        }
        .copy-btn { cursor: pointer; color: var(--text-primary); font-weight: bold; }
        pre { margin: 0; padding: 15px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 0.85rem; color: #dcdcdc; }

        /* --- BOTTOM INPUT AREA --- */
        .bottom-section {
            padding: 10px 20px 15px 20px; z-index: 1001;
            background: linear-gradient(transparent, var(--bg) 20%);
            display: flex; flex-direction: column; align-items: center;
        }

        .clear-bar { width: 100%; max-width: 800px; display: flex; justify-content: flex-end; margin-bottom: 5px; }
        .tiny-clear {
            font-size: 0.6rem; color: #ff453a; cursor: pointer; 
            border: 1px solid rgba(255,69,58,0.3); padding: 2px 8px; border-radius: 10px;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .input-bar {
            width: 100%; max-width: 800px; background: rgba(255,255,255,0.07);
            border: 1px solid var(--border); border-radius: 24px;
            display: flex; align-items: flex-end; padding: 10px 12px 10px 18px;
        }

        textarea {
            flex: 1; background: transparent; border: none; color: white;
            padding: 8px 0; font-size: 1rem; outline: none; resize: none;
            max-height: 150px; font-family: inherit; line-height: 1.4;
        }

        #send-btn {
            background: white; color: black; border: none; width: 36px; height: 36px;
            border-radius: 50%; cursor: pointer; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; margin-left: 10px;
        }

        .footer-info {
            margin-top: 10px; font-size: 0.65rem; color: var(--text-secondary); text-align: center;
        }

        #scroll-down-btn {
            position: fixed; bottom: 160px; right: 20px; z-index: 999;
            background: white; color: black; border: none; width: 32px; height: 32px;
            border-radius: 50%; display: none; align-items: center; justify-content: center;
        }

        @media (max-width: 600px) {
            .footer-info { font-size: 0.6rem; }
            main { padding: 15px; }
        }
    </style>
</head>
<body onload="loadChat()">

    <div class="stars-container"></div>
    <div class="nebula-glow"></div>

    <button id="scroll-down-btn" onclick="scrollToBottom()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="6 9 12 15 18 9"></polyline></svg>
    </button>

    <header>
        <div class="logo-area" style="display: flex; align-items: baseline; gap: 12px;">
            <div class="logo" style="font-size: 1.1rem; letter-spacing: 4px; color: var(--text-primary);">
                NEBULA<b style="color: var(--accent-blue);">AI</b>
            </div>
            <div class="version-badge" style="opacity: 0.7; font-weight: 600; border-color: rgba(255,255,255,0.05);">
                V1.0 SRM
            </div>
        </div>
        <button class="icon-btn" onclick="shareApp()" style="
            background: rgba(255,255,255,0.05); 
            border: 1px solid var(--border); 
            padding: 6px 16px; 
            border-radius: 12px; 
            font-weight: 700; 
            font-size: 0.6rem;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
            color: white;
            transition: 0.3s ease;
            cursor: pointer;">
            SHARE
        </button>
    </header>

    <main id="chat-container"></main>

    <div class="bottom-section">
        <div class="clear-bar">
            <div class="tiny-clear" onclick="clearChat()">Clear</div>
        </div>
        <div class="input-bar">
            <textarea id="user-input" rows="1" placeholder="Type a message..." oninput="autoExpand(this)"></textarea>
            <button id="send-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
            </button>
        </div>
        <div class="footer-info">
            Created by <b>Maulik Makwana</b> â€¢ Nebula AI can make mistakes.
        </div>
    </div>

    <script>
        const API_KEY = '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'; 
        const MODEL_ID = 'llama-3.1-8b-instant';
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const scrollBtn = document.getElementById('scroll-down-btn');

        function autoExpand(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        function formatAIResponse(text) {
            const codeRegex = /```(\w*)\n([\s\S]*?)```/g;
            let formatted = text.replace(codeRegex, (match, lang, code) => {
                const id = 'code-' + Math.random().toString(36).substr(2, 9);
                return `
                <div class="code-container">
                    <div class="code-header">
                        <span>${lang.toUpperCase() || 'CODE'}</span>
                        <span class="copy-btn" onclick="copyCode('${id}')">COPY</span>
                    </div>
                    <pre id="${id}">${code.trim()}</pre>
                </div>`;
            });
            return formatted;
        }

        function copyCode(id) {
            const code = document.getElementById(id).innerText;
            navigator.clipboard.writeText(code);
            alert('Code copied!');
        }

        function scrollToBottom() { chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' }); }

        chatContainer.onscroll = () => {
            scrollBtn.style.display = (chatContainer.scrollHeight - chatContainer.scrollTop > chatContainer.clientHeight + 100) ? 'flex' : 'none';
        };

        function saveChat() { localStorage.setItem('nebula_chat_history', chatContainer.innerHTML); }

        function loadChat() {
            const savedData = localStorage.getItem('nebula_chat_history');
            if (savedData) {
                chatContainer.innerHTML = savedData;
                scrollToBottom();
            } else {
                appendMessage('Nebula Here, How can I assist today?', 'ai');
            }
        }

        async function handleSend() {
            const query = userInput.value.trim();
            if (!query) return;

            appendMessage(query, 'user');
            userInput.value = '';
            userInput.style.height = 'auto';
            
            const loadingId = 'loading-' + Date.now();
            const aiMsg = appendMessage('...', 'ai', loadingId);
            saveChat();

            try {
                const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: MODEL_ID,
                        messages: [{ role: "system", content: "You are Nebula AI. If you write code, wrap it in triple backticks." }, { role: "user", content: query }]
                    })
                });
                const data = await response.json();
                const rawText = data.choices[0].message.content;
                aiMsg.innerHTML = formatAIResponse(rawText);
                saveChat();
                scrollToBottom();
            } catch (err) {
                aiMsg.innerText = "Connection error.";
            }
        }

        function appendMessage(text, type, id = '') {
            const wrapper = document.createElement('div');
            wrapper.className = `msg-wrapper ${type}-wrapper`;
            const msg = document.createElement('div');
            msg.className = `msg ${type}`;
            if(id) msg.id = id;
            
            if (type === 'ai' && text.includes('code-container')) {
                msg.innerHTML = text;
            } else {
                msg.innerText = text;
            }
            
            wrapper.appendChild(msg);
            chatContainer.appendChild(wrapper);
            scrollToBottom();
            return msg;
        }

        function clearChat() {
            if(confirm("Clear conversation?")) {
                chatContainer.innerHTML = '';
                localStorage.removeItem('nebula_chat_history');
                appendMessage('Cleared.', 'ai');
            }
        }

        function shareApp() {
            if (navigator.share) navigator.share({ title: 'Nebula AI', url: window.location.href });
            else alert("Link copied!");
        }

        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && window.innerWidth > 600) {
                e.preventDefault();
                handleSend();
            }
        });

        sendBtn.addEventListener('click', handleSend);
    </script>
</body>
</html>
